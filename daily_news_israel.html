<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>中国科技新闻 - Innonation AI</title>

    <!-- Favicon -->
    <link rel="shortcut icon" href="https://innonation.oss-cn-beijing.aliyuncs.com/shortcut/in.jpg">

    <!-- 引入现代CSS框架 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome 6 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- AOS 动画库 -->
    <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">

    <!-- 使用通用样式 -->
    <link rel="stylesheet" href="common/css/variables.css">
    <link rel="stylesheet" href="common/css/components.css">
    <link rel="stylesheet" href="common/css/inno-global-menu.css">

    <!-- 页面特定样式 -->
    <link rel="stylesheet" href="css/daily_news_israel.css">

    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- AOS 动画库脚本 -->
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
</head>
<body>
    <div id="app" v-cloak>
        <!-- 全局菜单挂载点（公共组件渲染） -->
        <div id="inno-global-menu"></div>

        <!-- Loading State -->
        <div v-if="loading" class="position-fixed top-0 start-0 w-100 h-100 bg-white bg-opacity-75 d-flex align-items-center justify-content-center" style="z-index: 9999;">
            <div class="text-center">
                <div class="loading-logo" style="font-weight: 700; font-size: 2rem; color: #104991; margin-bottom: 1.5rem;">INNONATION <b>AI</b></div>
                <div class="spinner-border text-primary mb-3" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>

        <!-- 导航栏 -->
        <nav class="navbar navbar-expand-lg fixed-top">
            <div class="container">
                <a class="navbar-brand" href="#">
                    INNONATION <b>AI</b>
                </a>
                <div class="ms-auto d-flex align-items-center gap-3">
                    <!-- 语言切换按钮 -->
                    <div class="language-switch" @click="toggleLanguage">
                        <i class="fas fa-globe"></i>
                        <span>{{ currentLang === 'zh' ? 'EN' : '中' }}</span>
                    </div>
                </div>
            </div>
        </nav>

        <!-- 主内容区域 -->
        <div class="main-content">
            <div class="container page-container with-fixed-header">
                <!-- 页面标题 -->
                <div class="row mb-4" data-aos="fade-up">
                    <div class="col-12">
                        <h1 class="page-title fw-bold text-center mb-4">
                            <span name="message-CHINA-TECH">{{ t('page-title') }}</span>
                        </h1>
                    </div>
                </div>

                <!-- 主要内容区域 -->
                <div class="row" data-aos="fade-up" data-aos-delay="100">
                    <div class="col-12">
                        <div class="box">
                            <div class="box-header">
                                <h3 class="box-title">
                                    <i class="fas fa-newspaper me-2"></i>
                                    <span name="message-CHINA-TECH">{{ t('page-title') }}</span>
                                </h3>
                                <!-- 标签页（暂时注释掉，与原始页面保持一致） -->
                                <!--
                                <div class="tabs">
                                    <div class="tab"
                                         :class="{ 'active': activeTab === '' }"
                                         @click="switchTab('')">
                                        ALL
                                    </div>
                                    <div class="tab"
                                         :class="{ 'active': activeTab === 'AI相关' }"
                                         @click="switchTab('AI相关')">
                                        AI
                                    </div>
                                    <div class="tab"
                                         :class="{ 'active': activeTab === 'deepseek相关' }"
                                         @click="switchTab('deepseek相关')">
                                        DeepSeek
                                    </div>
                                    <div class="tab"
                                         :class="{ 'active': activeTab === 'IPO事件' }"
                                         @click="switchTab('IPO事件')">
                                        IPO
                                    </div>
                                    <div class="tab"
                                         :class="{ 'active': activeTab === '医疗相关' }"
                                         @click="switchTab('医疗相关')">
                                        Medical Treatment
                                    </div>
                                    <div class="tab"
                                         :class="{ 'active': activeTab === '投资融资事件' }"
                                         @click="switchTab('投资融资事件')">
                                        Investment & MA
                                    </div>
                                    <div class="tab"
                                         :class="{ 'active': activeTab === '政策相关' }"
                                         @click="switchTab('政策相关')">
                                        Policy
                                    </div>
                                </div>
                                -->
                            </div>

                            <div class="box-body position-relative">
                                <!-- 加载遮罩层 -->
                                <!-- <div class="loading-overlay" v-show="loading">
                                    <div class="loading-spinner"></div>
                                </div> -->

                                <!-- 新闻卡片网格 -->
                                <div class="card-grid">
                                    <div class="card" v-for="item in newsList" @click="openModal(item)" data-aos="fade-up">
                                        <div class="card-body">
                                            <div class="news-title" v-if="!isEnglish">{{item.ChineseTitle}}</div>
                                            <div class="news-title" v-if="isEnglish">{{item.EnglishTitle}}</div>
                                            <div class="news-content" v-if="!isEnglish">{{item.ChineseSummary}}</div>
                                            <div class="news-content" v-if="isEnglish">{{item.EnglishSummary}}</div>
                                        </div>
                                        <div class="footer">
                                            <div class="time">{{item.Date}}</div>
                                            <!--<div class="type">{{item.EnglishTags}}</div>-->
                                        </div>
                                    </div>
                                </div>

                                <!-- 分页组件 -->
                                <div class="pagination" v-show="totalPages > 0">
                                    <button class="page-button page-nav"
                                            @click="prevPage"
                                            :disabled="currentPage === 1">
                                        <span name="message-prev-page">{{ t('prev-page') }}</span>
                                    </button>

                                    <button class="page-button"
                                            v-for="item in displayedPages"
                                            @click="item.page && goToPage(item.page)"
                                            :class="{
                                                'active': currentPage === item.page,
                                                'disabled': !item.page
                                            }">
                                        {{item.text}}
                                    </button>

                                    <button class="page-button page-nav"
                                            @click="nextPage"
                                            :disabled="currentPage === totalPages">
                                        <span name="message-next-page">{{ t('next-page') }}</span>
                                    </button>
                                </div>

                                <!-- 详情模态框 -->
                                <div class="detail-modal" v-if="showModal" :class="{'modal-closing': isClosing}">
                                    <div class="modal-backdrop" @click="closeModal"></div>
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <span class="close" @click="closeModal">&times;</span>
                                            <div class="modal-title" v-if="!isEnglish">{{selectedItem.ChineseTitle}}</div>
                                            <div class="modal-title" v-if="isEnglish">{{selectedItem.EnglishTitle}}</div>
                                        </div>
                                        <div class="modal-body">
                                            <div class="modal-text" v-if="!isEnglish">{{selectedItem.ChineseSummary}}</div>
                                            <div class="modal-text" v-if="isEnglish">{{selectedItem.EnglishSummary}}</div>
                                            <!--<div class="modal-date" v-if="!isEnglish">{{selectedItem.ChineseTags}}</div>
                                            <div class="modal-date" v-if="isEnglish">{{selectedItem.EnglishTags}}</div>-->
                                            <div class="modal-references">
                                                <a :href="selectedItem.Url" target="_blank" class="reference-link">
                                                    {{isEnglish ? 'Reference Link' : '参考链接'}}
                                                </a>
                                            </div>
                                            <div class="modal-date">{{selectedItem.Date}}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script src="common/js/common-utils.js"></script>
    <script src="common/js/api-client.js"></script>

    <!-- 全局菜单组件 -->
    <script src="common/js/inno-global-menu.js"></script>

    <!-- 兼容原有 common.js 的桥接代码 -->
    <script>
        // 兼容原有的 common 对象
        if (typeof common === 'undefined') {
            window.common = {
                APIDomain: 'https://ai.innonation.io/inno_ai_services',
                hideMask: function() {
                    console.log('hideMask called');
                }
            };
        }

        // 监听语言切换事件
        window.addEventListener('inno_lang_change', function(e) {
            const lang = e.detail;
            if (window.InnoMenu) {
                window.InnoMenu.setLang(lang);
            }
        });
    </script>

    <!-- 初始化 AOS 动画 -->
    <script>
        // 确保 AOS 库已加载后再初始化
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof AOS !== 'undefined') {
                AOS.init({
                    duration: 800,
                    easing: 'ease-in-out',
                    once: true,
                    offset: 120
                });
            }
        });
    </script>

    <!-- Vue 应用 -->
    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // 基础配置
                    currentPage: 1,
                    pageSize: 12,
                    total: 0,

                    // 新闻数据
                    newsList: [],
                    selectedItem: {},

                    // 应用状态
                    loading: false,

                    // i18n 翻译
                    translations: {},

                    // 语言状态
                    currentLang: 'zh',
                    isEnglish: false,

                    // 模态框状态
                    showModal: false,
                    isClosing: false,

                    // 标签页状态
                    activeTab: ''
                }
            },

            computed: {
                totalPages() {
                    return Math.ceil(this.total / this.pageSize);
                },

                displayedPages() {
                    let pages = [];
                    const total = this.totalPages;
                    const current = this.currentPage;

                    if (total <= 7) {
                        for (let i = 1; i <= total; i++) {
                            pages.push({ page: i, text: i });
                        }
                    } else {
                        if (current <= 4) {
                            for (let i = 1; i <= 5; i++) {
                                pages.push({ page: i, text: i });
                            }
                            pages.push({ page: null, text: '...' });
                            pages.push({ page: total, text: total });
                        } else if (current >= total - 3) {
                            pages.push({ page: 1, text: '1' });
                            pages.push({ page: null, text: '...' });
                            for (let i = total - 4; i <= total; i++) {
                                pages.push({ page: i, text: i });
                            }
                        } else {
                            pages.push({ page: 1, text: '1' });
                            pages.push({ page: null, text: '...' });
                            for (let i = current - 1; i <= current + 1; i++) {
                                pages.push({ page: i, text: i });
                            }
                            pages.push({ page: null, text: '...' });
                            pages.push({ page: total, text: total });
                        }
                    }
                    return pages;
                }
            },

            async mounted() {
                // 立即滚动到顶部，防止浏览器自动恢复滚动位置
                if ('scrollRestoration' in history) {
                    history.scrollRestoration = 'manual';
                }
                window.scrollTo(0, 0);
                document.documentElement.scrollTop = 0;
                document.body.scrollTop = 0;

                this.getCurrentLang();
                await this.loadI18n();
                await this.loadNews();

                // 最终确保页面在顶部
                this.$nextTick(() => {
                    setTimeout(() => {
                        window.scrollTo(0, 0);
                        document.documentElement.scrollTop = 0;
                        document.body.scrollTop = 0;
                    }, 100);
                });
            },

            methods: {
                // i18n 方法
                t(key) {
                    return this.translations[key] || key;
                },

                async loadI18n() {
                    try {
                        const lang = this.currentLang;
                        const response = await fetch(`common/i18n/daily_news_israel.${lang}.json`);
                        if (!response.ok) {
                            throw new Error(`Failed to load i18n: ${response.status}`);
                        }
                        this.translations = await response.json();
                    } catch (error) {
                        console.error('Failed to load i18n:', error);
                        // 设置默认翻译
                        this.translations = {
                            loading: this.currentLang === 'zh' ? '加载中...' : 'Loading...',
                            'page-title': this.currentLang === 'zh' ? '中国科技新闻' : 'China Tech News',
                            'prev-page': this.currentLang === 'zh' ? '上一页' : 'Previous',
                            'next-page': this.currentLang === 'zh' ? '下一页' : 'Next'
                        };
                    }
                },

                getCurrentLang() {
                    const storedLang = localStorage.getItem('inno_lang');
                    if (storedLang) {
                        this.currentLang = storedLang;
                        this.isEnglish = storedLang === 'en';
                    } else {
                        this.currentLang = "zh";
                        this.isEnglish = false;
                    }
                },

                async toggleLanguage() {
                    const newLang = this.currentLang === 'zh' ? 'en' : 'zh';
                    this.currentLang = newLang;
                    this.isEnglish = newLang === 'en';
                    localStorage.setItem('inno_lang', newLang);

                    // 触发语言切换事件
                    window.dispatchEvent(new CustomEvent('inno_lang_change', { detail: newLang }));

                    // 重新加载翻译
                    await this.loadI18n();
                },

                switchTab(tab) {
                    this.activeTab = tab;
                    this.currentPage = 1;
                    this.newsList = [];
                    this.total = 0;
                    this.loadNews();
                },

                async loadNews() {
                    this.loading = true;

                    try {
                        const response = await axios.get(common.APIDomain + '/api/News/GetRSSNews', {
                            params: {
                                page: this.currentPage,
                                pageSize: this.pageSize
                            }
                        });

                        if (response.data.ReturnCode === 0) {
                            this.newsList = response.data.Data.Items;
                            this.total = response.data.Data.Total;
                        } else {
                            console.error('Failed to load news:', response.data.Message);
                        }
                    } catch (error) {
                        console.error('Error loading news:', error);
                    } finally {
                        this.loading = false;
                    }
                },

                prevPage() {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                        this.loadNews();
                        window.scrollTo(0, 0);
                    }
                },

                nextPage() {
                    if (this.currentPage < this.totalPages) {
                        this.currentPage++;
                        this.loadNews();
                        window.scrollTo(0, 0);
                    }
                },

                goToPage(page) {
                    if (page && page !== this.currentPage && page >= 1 && page <= this.totalPages) {
                        this.currentPage = page;
                        this.loadNews();
                        window.scrollTo(0, 0);
                    }
                },

                openModal(item) {
                    this.selectedItem = item;
                    this.showModal = true;
                    this.isClosing = false;
                    document.body.style.overflow = 'hidden';
                },

                closeModal() {
                    this.isClosing = true;
                    setTimeout(() => {
                        this.showModal = false;
                        this.isClosing = false;
                        document.body.style.overflow = '';
                    }, 300);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
